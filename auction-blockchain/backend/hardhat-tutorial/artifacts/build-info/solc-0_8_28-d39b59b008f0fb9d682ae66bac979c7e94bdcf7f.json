{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-d39b59b008f0fb9d682ae66bac979c7e94bdcf7f",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/Auction.sol": "project/contracts/Auction.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/Auction.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.19;\r\n\r\ncontract Auction {\r\n\r\n    struct AuctionItem {\r\n        uint256 id;\r\n        string name;\r\n        string description;\r\n        string imageUrl;\r\n        uint256 startingPrice;\r\n        uint256 currentPrice;\r\n        uint256 endTime;\r\n        address payable seller;\r\n        address payable highestBidder;\r\n        bool isCompleted; // CH·ªà C·∫¶N BI·∫æN N√ÄY\r\n    }\r\n\r\n    struct Bid {\r\n        address bidder;\r\n        uint256 amount;\r\n        uint256 timestamp;\r\n    }\r\n\r\n    mapping(uint256 => AuctionItem) public auctions;\r\n    mapping(uint256 => Bid[]) public auctionBids;\r\n\r\n    // Ti·ªÅn ho√†n cho ng∆∞·ªùi b·ªã v∆∞·ª£t gi√°\r\n    mapping(uint256 => mapping(address => uint256)) public pendingReturns;\r\n\r\n    uint256 public auctionCounter;\r\n    uint256 public platformFeePercent = 2;\r\n    address payable public owner;\r\n\r\n    /* ===================== EVENTS ===================== */\r\n    event AuctionCreated(uint256 auctionId, string name, uint256 startingPrice, uint256 endTime);\r\n    event BidPlaced(uint256 auctionId, address bidder, uint256 amount);\r\n    event AuctionEnded(uint256 auctionId, address winner, uint256 finalPrice);\r\n    event FundsWithdrawn(address user, uint256 amount);\r\n\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, \"Only owner\");\r\n        _;\r\n    }\r\n\r\n    constructor() {\r\n        owner = payable(msg.sender);\r\n    }\r\n\r\n    /* ===================== CREATE AUCTION ===================== */\r\n    function createAuction(\r\n        string memory _name,\r\n        string memory _description,\r\n        string memory _imageUrl,\r\n        uint256 _startingPrice,\r\n        uint256 _duration\r\n    ) external {\r\n        require(_startingPrice > 0, \"Starting price > 0\");\r\n        require(_duration >= 300, \"Min 5 minutes\");\r\n\r\n        uint256 auctionId = auctionCounter++;\r\n\r\n        auctions[auctionId] = AuctionItem({\r\n            id: auctionId,\r\n            name: _name,\r\n            description: _description,\r\n            imageUrl: _imageUrl,\r\n            startingPrice: _startingPrice,\r\n            currentPrice: _startingPrice,\r\n            endTime: block.timestamp + _duration,\r\n            seller: payable(msg.sender),\r\n            highestBidder: payable(address(0)),\r\n            isCompleted: false\r\n        });\r\n\r\n        emit AuctionCreated(\r\n            auctionId,\r\n            _name,\r\n            _startingPrice,\r\n            block.timestamp + _duration\r\n        );\r\n    }\r\n\r\n    /* ===================== PLACE BID ===================== */\r\n    function placeBid(uint256 _auctionId) external payable {\r\n        AuctionItem storage auction = auctions[_auctionId];\r\n\r\n        require(!auction.isCompleted, \"Auction ended\");\r\n        require(block.timestamp < auction.endTime, \"Auction ended\");\r\n        require(msg.sender != auction.seller, \"Seller cannot bid\");\r\n        require(msg.value > auction.currentPrice, \"Bid too low\");\r\n\r\n        if (auction.highestBidder != address(0)) {\r\n            pendingReturns[_auctionId][auction.highestBidder] += auction.currentPrice;\r\n        }\r\n\r\n        auction.currentPrice = msg.value;\r\n        auction.highestBidder = payable(msg.sender);\r\n\r\n        auctionBids[_auctionId].push(\r\n            Bid(msg.sender, msg.value, block.timestamp)\r\n        );\r\n\r\n        emit BidPlaced(_auctionId, msg.sender, msg.value);\r\n    }\r\n\r\n    /* ===================== END AUCTION ===================== */\r\n    function endAuction(uint256 _auctionId) external {\r\n        AuctionItem storage auction = auctions[_auctionId];\r\n\r\n        require(!auction.isCompleted, \"Already ended\");\r\n        require(block.timestamp >= auction.endTime, \"Not finished yet\");\r\n        require(\r\n            msg.sender == auction.seller || msg.sender == owner,\r\n            \"Not authorized\"\r\n        );\r\n\r\n        auction.isCompleted = true;\r\n\r\n        if (auction.highestBidder != address(0)) {\r\n            uint256 platformFee =\r\n                (auction.currentPrice * platformFeePercent) / 100;\r\n\r\n            uint256 sellerAmount =\r\n                auction.currentPrice - platformFee;\r\n\r\n            auction.seller.transfer(sellerAmount);\r\n            owner.transfer(platformFee);\r\n\r\n            emit AuctionEnded(\r\n                _auctionId,\r\n                auction.highestBidder,\r\n                auction.currentPrice\r\n            );\r\n        } else {\r\n            emit AuctionEnded(_auctionId, address(0), 0);\r\n        }\r\n    }\r\n\r\n    /* ===================== WITHDRAW REFUND ===================== */\r\n    function withdraw(uint256 _auctionId) external {\r\n        uint256 amount = pendingReturns[_auctionId][msg.sender];\r\n        require(amount > 0, \"Nothing to withdraw\");\r\n\r\n        pendingReturns[_auctionId][msg.sender] = 0;\r\n        payable(msg.sender).transfer(amount);\r\n\r\n        emit FundsWithdrawn(msg.sender, amount);\r\n    }\r\n\r\n    /* ===================== VIEW FUNCTIONS ===================== */\r\n\r\n    // üü¢ ƒêANG ƒê·∫§U GI√Å\r\n    function getAllActiveAuctions() external view returns (AuctionItem[] memory) {\r\n        uint256 count;\r\n        for (uint256 i = 0; i < auctionCounter; i++) {\r\n            if (\r\n                !auctions[i].isCompleted &&\r\n                block.timestamp < auctions[i].endTime\r\n            ) {\r\n                count++;\r\n            }\r\n        }\r\n\r\n        AuctionItem[] memory result = new AuctionItem[](count);\r\n        uint256 index;\r\n\r\n        for (uint256 i = 0; i < auctionCounter; i++) {\r\n            if (\r\n                !auctions[i].isCompleted &&\r\n                block.timestamp < auctions[i].endTime\r\n            ) {\r\n                result[index++] = auctions[i];\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // üü° CH·ªú K·∫æT TH√öC\r\n    function getWaitingEndAuctions() external view returns (AuctionItem[] memory) {\r\n        uint256 count;\r\n        for (uint256 i = 0; i < auctionCounter; i++) {\r\n            if (\r\n                !auctions[i].isCompleted &&\r\n                block.timestamp >= auctions[i].endTime\r\n            ) {\r\n                count++;\r\n            }\r\n        }\r\n\r\n        AuctionItem[] memory result = new AuctionItem[](count);\r\n        uint256 index;\r\n\r\n        for (uint256 i = 0; i < auctionCounter; i++) {\r\n            if (\r\n                !auctions[i].isCompleted &&\r\n                block.timestamp >= auctions[i].endTime\r\n            ) {\r\n                result[index++] = auctions[i];\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // üî¥ ƒê√É K·∫æT TH√öC\r\n    function getCompletedAuctions() external view returns (AuctionItem[] memory) {\r\n        uint256 count;\r\n        for (uint256 i = 0; i < auctionCounter; i++) {\r\n            if (auctions[i].isCompleted) {\r\n                count++;\r\n            }\r\n        }\r\n\r\n        AuctionItem[] memory result = new AuctionItem[](count);\r\n        uint256 index;\r\n\r\n        for (uint256 i = 0; i < auctionCounter; i++) {\r\n            if (auctions[i].isCompleted) {\r\n                result[index++] = auctions[i];\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function getAuction(uint256 _auctionId)\r\n        external\r\n        view\r\n        returns (AuctionItem memory)\r\n    {\r\n        return auctions[_auctionId];\r\n    }\r\n\r\n    function getAuctionBids(uint256 _auctionId)\r\n        external\r\n        view\r\n        returns (Bid[] memory)\r\n    {\r\n        return auctionBids[_auctionId];\r\n    }\r\n\r\n    function getPendingReturn(uint256 _auctionId, address _user)\r\n        external\r\n        view\r\n        returns (uint256)\r\n    {\r\n        return pendingReturns[_auctionId][_user];\r\n    }\r\n\r\n    function updatePlatformFee(uint256 _newFee) external onlyOwner {\r\n        require(_newFee <= 10, \"Max 10%\");\r\n        platformFeePercent = _newFee;\r\n    }\r\n\r\n    receive() external payable {}\r\n}\r\n"
      }
    }
  }
}